<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Leaflet Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    /* Styling for the map container */
    #map {
      height: 980px;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-database.js"></script>

  <script>
    const config = {
      apiKey: "AIzaSyAXuOVjRh9eeo96tLi7LeHft4Dc9xKoJQE",
      authDomain: "maps-5d90d.firebaseapp.com",
      databaseURL: "https://maps-5d90d-default-rtdb.firebaseio.com",
      projectId: "maps-5d90d",
      storageBucket: "maps-5d90d.appspot.com",
      messagingSenderId: "1007587899818",
      appId: "1:1007587899818:web:51c720fd45cf88eca853d3",
      measurementId: "G-DK387MGBL3"
    };

    firebase.initializeApp(config);
    var detailsRef = firebase.database().ref('registrationForm');

    const map = L.map('map').setView([0, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map);

    const urlParams = new URLSearchParams(window.location.search);

    const latitude = parseFloat(urlParams.get('lat'));
    const longitude = parseFloat(urlParams.get('lng'));

    // Set the map center based on the provided latitude and longitude
    map.setView([latitude, longitude], 13);

    // Call getDetails to update markers with names from Firebase
    getDetails(latitude, longitude);

    function getDetails(latitude, longitude) {
      detailsRef.on('value', function(snapshot) {
        snapshot.forEach(snap => {
          const issue = snap.val();
          displayPopup(issue);
        });
      });
    }

    function displayPopup(detail) {
      var popupContent = `
      Username: ${detail.Username}<br>
        Email: ${detail.Email}<br>
        Password: ${detail.Password}<br>
        Address:${detail.Address}<br>
        Latitude:${detail.Latitude}<br>
        Longitude:${detail.Longitude}<br>
        CameraMode:${detail.CameraMode}<br>
        Resolution: ${detail.Resolution}<br>
        RecordingCapabilities: ${detail.RecordingCapabilities}<br>
        LicenseNumber: ${detail.LicenseNumber}<br>
        OwnerName: ${detail.OwnerName}<br>
        OwnerAddress: ${detail.OwnerAddress}<br>
        OwnerContact: ${detail.OwnerContact}<br>
        VisibilityRange: ${detail.VisibilityRange}<br>
        FieldOfView: ${detail.FieldOfView}
      `;

      L.marker([detail.Latitude, detail.Longitude])
        .bindPopup(popupContent)
        .addTo(map)
        .openPopup();
    }
  </script>
</body>
</html>
